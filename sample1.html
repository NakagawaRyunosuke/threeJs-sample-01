<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>sample1</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/99/three.min.js"></script>

</head>
<body>
  <h2>色々な図形の表示</h2>
  <p>本課題では、様々な形をレンダリングして動かしてみた。</p>
  
 <script>
  const init = function() {

    const width = 800,
        height = 600;
  
    // レンダラーを作成
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(width, height);
    document.body.appendChild(renderer.domElement);
  
    // シーンを作成
    const scene = new THREE.Scene();

    // カメラを作成
    const camera = new THREE.PerspectiveCamera(90, width / height, 1, 1000);
    camera.position.set(0, 0, 5);  //位置を指定
    camera.lookAt(0, 0, 0); //見つめる方向

    
    // 平行光源
    const directionalLight1 = new THREE.DirectionalLight(0xffffff);
    directionalLight1.position.set(5, 1, 1);   //位置を指定
    scene.add(directionalLight1);     // シーンに追加

    // 平行光源
    const directionalLight2 = new THREE.DirectionalLight(0x666666);
    directionalLight2.position.set(-5, 1, 1);   //位置を指定
    scene.add(directionalLight2);     // シーンに追加
      
    // helper
    // const gridHelper = new THREE.GridHelper(2,10); // size, step
    // scene.add(gridHelper);
    const axisHelper = new THREE.AxisHelper(5); //軸の長さ　X：赤、Y：緑、z：青
    scene.add(axisHelper);

    // 箱を作成
    // const geometry = new THREE.BoxGeometry(1, 1, 1);
    // const material = new THREE.MeshPhongMaterial({ color: 0x0000ff });
    // const box = new THREE.Mesh(geometry, material);
    // box.position.set(0,0,0); //位置を指定
    // scene.add(box);   // シーンに追加


    // 球を追加
    const sphereGeometry = new THREE.SphereGeometry(1,32,32);
    const sphereMaterial = new THREE.MeshNormalMaterial();
    const sphere = new THREE.Mesh(sphereGeometry,sphereMaterial);
    sphere.position.set(0,0,-30);
    scene.add(sphere);
  
    //ドーナッツ追加
    const torusGeometry1 = new THREE.TorusGeometry( 5, 1, 6, 12 ); 
    const torusMaterial1 = new THREE. MeshToonMaterial( { color: 0x006400, wireframe: true } );
    torus1 = new THREE.Mesh( torusGeometry1, torusMaterial1 );
    torus1.position.set( -2, 0, -15);
    scene.add(torus1);

    const torusGeometry2 = new THREE.TorusGeometry( 5, 1, 6, 12 ); 
    const torusMaterial2 = new THREE. MeshToonMaterial( { color: 0x006400, wireframe: true } );
    torus2 = new THREE.Mesh( torusGeometry2, torusMaterial2 );
    torus2.position.set( 2, 0, -15);
    scene.add(torus2);

    //なんかくねくね追加
    const torusKnotGeometry1 = new THREE.TorusKnotGeometry( 1.5, 0.3, 20, 6, 3, 2 );
    const torusKnotMaterial1 = new THREE.MeshPhongMaterial({ color:0xffd700 });
    torusKnot1 = new THREE.Mesh(torusKnotGeometry1,torusKnotMaterial1);
    torusKnot1.position.set( -8,8,-15);
    scene.add(torusKnot1);

    const torusKnotGeometry2 = new THREE.TorusKnotGeometry( 1.5, 0.3, 20, 6, 3, 2 );
    const torusKnotMaterial2 = new THREE.MeshPhongMaterial({ color:0xffa500 });
    torusKnot2 = new THREE.Mesh(torusKnotGeometry2,torusKnotMaterial2);
    torusKnot2.position.set( 8,8,-15);
    scene.add(torusKnot2);

    const torusKnotGeometry3 = new THREE.TorusKnotGeometry( 1.5, 0.3, 20, 6, 3, 2 );
    const torusKnotMaterial3 = new THREE.MeshPhongMaterial({ color:0xdcdcdc });
    torusKnot3 = new THREE.Mesh(torusKnotGeometry3,torusKnotMaterial3);
    torusKnot3.position.set( 0,-8,-15);
    scene.add(torusKnot3);

    //円錐
    const cylinderGeometry = new THREE.CylinderGeometry( 0, 3, 6, 8 );
    const cylinderMaterial = new THREE.MeshPhongMaterial( {color: 0x7fffd4} );
    const cylinder = new THREE.Mesh( cylinderGeometry, cylinderMaterial );
    cylinder.position.set( 0, 0, -20 );
    scene.add( cylinder );


    let mode = "+z";
    // 初回実行
    const update = function() {
      requestAnimationFrame(update);
      console.log(sphere.position.z)
      mode = modeChange(sphere,mode);
      console.log(mode)
      sphereMove(mode,sphere);
      // 箱を回転させる
      // box.rotation.x += 0.01;
      // box.rotation.y += 0.01;
      torusKnot1.rotation.y += 0.2;
      torusKnot1.rotation.z += 0.2;
      torusKnot2.rotation.y += 0.2;
      torusKnot2.rotation.z += 0.2;
      torusKnot3.rotation.y += 0.2;
      torusKnot3.rotation.z += 0.2;
      sphere.rotation.x += 0.01;
      sphere.rotation.z += 0.01;
      torus1.rotation.y += 0.01;
      torus1.position.z += 0.02;
      torus2.rotation.y -= 0.01;
      torus2.position.z += 0.02;
      cylinder.position.z += 0.5;
  
      renderer.render(scene, camera);
    };
    update();
  }

  function modeChange(sphere,mode){
    if(Math.floor(sphere.position.z) == 3){
      return "-z";
    }else if(Math.floor(sphere.position.z) == -10){
      return "+z";
    }else {
      return mode;
    }
  }

  function sphereMove(mode,sphere){
    switch(mode){
      case "+z":
        sphere.position.z += 0.1;
        break;
      case "-z":
        sphere.position.z -= 0.1;
        break;
      default:
        break; 
    }
  }

  window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
